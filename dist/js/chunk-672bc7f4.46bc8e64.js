(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-672bc7f4"],{"159b":function(t,e,r){var a=r("da84"),n=r("fdbc"),o=r("17c2"),i=r("9112");for(var s in n){var c=a[s],l=c&&c.prototype;if(l&&l.forEach!==o)try{i(l,"forEach",o)}catch(u){l.forEach=o}}},"17c2":function(t,e,r){"use strict";var a=r("b727").forEach,n=r("a640"),o=r("ae40"),i=n("forEach"),s=o("forEach");t.exports=i&&s?[].forEach:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}},"3cf7":function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"content-detail"},[r("div",{staticClass:"article-detail"},[r("div",{staticClass:"markdown-body author-detail"},[r("div",{staticClass:"author"},[t._v(t._s(t.article.author))]),r("el-button",{staticClass:"like",attrs:{"native-type":"button",size:"mini",type:t.follow?"":"danger",round:""},on:{click:function(e){return t.followed(t.follow)}}},[t._v(t._s(t.follow?"取消关注":"关注"))]),r("div",{staticClass:"article-info"},[t._v("字数"+t._s(t.article.body_num)+" 阅读 "+t._s(t.article.read))])],1),r("div",{staticClass:"editor"},[r("mavon-editor",{attrs:{boxShadow:!1},domProps:{innerHTML:t._s(t.article.body_html)}})],1),t.article.id?r("div",{staticClass:"markdown-body comment-warp"},[r("Comment",{attrs:{article:t.article.id,author:t.article.author_id}})],1):t._e()]),r("div",{staticClass:"relation_list"},[[r("el-table",{staticStyle:{width:"100%"},attrs:{data:t.articles}},[r("div",[r("el-table-column",{attrs:{label:"相关文章"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("router-link",{staticClass:"login-register",attrs:{tag:"a",to:"/article/detail/"+e.row.id,target:"_blank"}},[t._v(" "+t._s(e.row.title)+" ")]),r("p",[t._v("阅读 "+t._s(e.row.read))])]}}])})],1)])]],2),t.wordCloudData.length>0?r("div",{staticClass:"word_cloud pull-right"},[r("wordCloud",{attrs:{data:t.wordCloudData,"size-range":[10,30]}})],1):t._e()])},n=[],o=r("2423"),i=r("c24f"),s=r("05d5"),c=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"comment"},[r("div",{staticClass:"comment-form"},[r("span",{staticClass:"pull-left"},[t._v("发表评论:")]),r("el-form",{ref:"commentForm",staticClass:"demo-ruleForm",attrs:{model:t.commentForm,"label-width":"100px"}},[r("el-form-item",{attrs:{prop:"comment",rules:[{required:!0,message:"评论不能为空"}]}},[r("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:6},placeholder:"请输入内容"},model:{value:t.commentForm.comment,callback:function(e){t.$set(t.commentForm,"comment",e)},expression:"commentForm.comment"}})],1),r("div",{staticClass:"btn pull-right"},[r("el-form-item",[r("el-button",{attrs:{size:"mini",type:"primary",round:""},on:{click:function(e){return t.submitForm("commentForm")}}},[t._v("发布")]),r("el-button",{attrs:{size:"mini",round:""},on:{click:function(e){return t.resetForm("commentForm")}}},[t._v("重置")])],1)],1)],1)],1),r("div",{staticClass:"comment-list"},[r("div",{staticClass:"comment-title"},[t._v(" 全部评论: "+t._s(t.totalpage)+" "),r("ul",{staticClass:"menu-tab pull-right"},t._l(t.menuTab,(function(e){return r("li",{key:e.id,class:[{current:e.current}],on:{click:function(r){return t.handleOrderChange(e)}}},[t._v(t._s(e.txt))])})),0)]),r("div",[[r("el-table",{staticStyle:{width:"100%"},attrs:{data:t.commentsData,"show-header":!1}},[r("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[r("div",{staticClass:"username"},[t._v(" "+t._s(e.row.author)+" "),e.row.author_id==t.userInfo.uid?r("el-button",{staticClass:"pull-right",attrs:{icon:"el-icon-delete",size:"mini",round:""},on:{click:function(r){return t.commentDelete(e,"user",e.row.author_id)}}}):t.author==t.userInfo.uid?r("el-button",{staticClass:"pull-right",attrs:{icon:"el-icon-delete",size:"mini",round:""},on:{click:function(r){return t.commentDelete(e,"author",t.author)}}}):1==t.roles.indexOf(t.userInfo.role)?r("el-button",{staticClass:"pull-right",attrs:{icon:"el-icon-delete",size:"mini",round:""},on:{click:function(r){return t.commentDelete(e,"admin",t.userInfo.uid)}}}):t._e()],1),r("div",{staticClass:"time"},[t._v(t._s(e.row.timestamp))]),r("div",{staticClass:"comment"},[t._v(t._s(e.row.body))])]}}])})],1)]],2),r("div",{staticClass:"pull-right pageination"},[r("el-pagination",{attrs:{background:"","current-page":t.currentPage,"page-size":t.per_page,layout:"prev, pager, next",total:t.totalpage},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e},"update:total":function(e){t.totalpage=e}}})],1)])])},l=[],u=(r("99af"),r("4160"),r("a434"),r("a9e3"),r("159b"),r("b775"));function d(t){return u["a"].request({method:"get",url:"/comment/list",params:t})}function f(t){return u["a"].request({method:"post",url:"/comment/create",params:t})}function m(t){return u["a"].request({method:"delete",url:"/comment/".concat(t.commentId),params:t})}var h={props:{article:{type:String},author:{type:Number}},data:function(){return{menuTab:[{txt:"按时间倒序",current:!0,type:"desc"},{txt:"按时间正序",current:!1,type:"asc"}],currentPage:1,totalpage:0,per_page:5,order:"desc",commentForm:{comment:""},commentsData:[],roles:["Moderator","Administrator"]}},methods:{initData:function(){this.getUserInfo(),this.getComments(1)},getUserInfo:function(){this.userInfo=this.$store.state.userInfo,this.isLive=this.$store.state.isLive},getComments:function(t){var e=this,r={page:t,per_page:this.per_page,article:this.article,sort:this.order};d(r).then((function(t){e.commentsData=t.data.data,e.totalpage=t.data.total})).catch((function(t){console.log(t)}))},commentDelete:function(t,e,r){var a=this,n={commentId:t.row.id,author:r};m(n).then((function(r){a.commentsData.splice(t.$index,1),"user"==e?a.$message({message:"用户删除评论",type:"success"}):"author"==e?a.$message({message:"作者删除评论",type:"success"}):a.$message({message:"管理员或协管员删除评论",type:"success"})})).catch((function(t){console.log(t)}))},handleCurrentChange:function(t){this.getComments(t)},handleOrderChange:function(t){this.menuTab.forEach((function(t){t.current=!1})),this.currentPage=1,this.order=t.type,t.current=!0,this.getComments(1)},submitForm:function(t){var e=this;this.isLive?this.$refs[t].validate((function(r){if(!r)return console.log("error submit!!"),!1;var a={body:e.commentForm.comment,article:e.article,user:e.userInfo.uid};f(a).then((function(r){e.resetForm(t),e.commentsData=[r.data.data].concat(e.commentsData),e.totalpage=e.totalpage+1})).catch((function(t){console.log(t)}))})):this.$message({message:"请先登录",type:"warning"})},resetForm:function(t){this.$refs[t].resetFields()}},created:function(){this.initData()}},p=h,g=(r("43b9"),r("2877")),v=Object(g["a"])(p,c,l,!1,null,"6d513ff2",null),b=v.exports,_={name:"articleDetail",components:{wordCloud:s["a"],Comment:b},data:function(){return{article:{},follow:!1,userinfo:{},islive:null,articles:[],wordCloudData:[]}},methods:{initData:function(){this.getArticleDetail(),this.getWordCloud(),this.getUserInfo()},getWordCloud:function(){var t=this,e={articles:this.articleId};Object(o["h"])(e).then((function(e){t.wordCloudData=e.data.data})).catch((function(t){console.log(t)}))},getArticleDetail:function(){var t=this;Object(o["c"])(this.articleId).then((function(e){t.article=e.data.data,t.getfollow(t.article.author_id),t.getArticles(t.article.author_id)})).catch((function(t){console.log(t)}))},getArticles:function(t){var e=this,r={page:1,per_page:5,author:t};Object(o["f"])(r).then((function(t){e.articles=t.data.data})).catch((function(t){console.log(t)}))},getUserInfo:function(){this.userinfo=this.$store.state.userInfo,this.islive=this.$store.state.isLive},getfollow:function(t){var e=this;if(this.islive){var r={user:this.userinfo.uid,author:t,type:2};Object(i["a"])(r).then((function(t){e.follow=t.data.data})).catch((function(t){console.log(t)}))}},followed:function(t){var e=this;if(this.checkUser()){var r={user:this.userinfo.uid,author:this.article.author_id};r.type=t?0:1,Object(i["a"])(r).then((function(r){e.follow=!t})).catch((function(t){console.log(t)}))}},checkUser:function(){if(this.islive)return!0;this.$router.push({name:"Login"})}},computed:{articleId:function(){return this.$route.params.articleId}},created:function(){this.initData()},mounted:function(){}},C=_,w=(r("d3ca"),Object(g["a"])(C,a,n,!1,null,"3487e010",null));e["default"]=w.exports},4160:function(t,e,r){"use strict";var a=r("23e7"),n=r("17c2");a({target:"Array",proto:!0,forced:[].forEach!=n},{forEach:n})},"43b9":function(t,e,r){"use strict";var a=r("87a5"),n=r.n(a);n.a},5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,r){var a=r("1d80"),n=r("5899"),o="["+n+"]",i=RegExp("^"+o+o+"*"),s=RegExp(o+o+"*$"),c=function(t){return function(e){var r=String(a(e));return 1&t&&(r=r.replace(i,"")),2&t&&(r=r.replace(s,"")),r}};t.exports={start:c(1),end:c(2),trim:c(3)}},7156:function(t,e,r){var a=r("861d"),n=r("d2bb");t.exports=function(t,e,r){var o,i;return n&&"function"==typeof(o=e.constructor)&&o!==r&&a(i=o.prototype)&&i!==r.prototype&&n(t,i),t}},"87a5":function(t,e,r){},9306:function(t,e,r){},a434:function(t,e,r){"use strict";var a=r("23e7"),n=r("23cb"),o=r("a691"),i=r("50c4"),s=r("7b0b"),c=r("65f0"),l=r("8418"),u=r("1dde"),d=r("ae40"),f=u("splice"),m=d("splice",{ACCESSORS:!0,0:0,1:2}),h=Math.max,p=Math.min,g=9007199254740991,v="Maximum allowed length exceeded";a({target:"Array",proto:!0,forced:!f||!m},{splice:function(t,e){var r,a,u,d,f,m,b=s(this),_=i(b.length),C=n(t,_),w=arguments.length;if(0===w?r=a=0:1===w?(r=0,a=_-C):(r=w-2,a=p(h(o(e),0),_-C)),_+r-a>g)throw TypeError(v);for(u=c(b,a),d=0;d<a;d++)f=C+d,f in b&&l(u,d,b[f]);if(u.length=a,r<a){for(d=C;d<_-a;d++)f=d+a,m=d+r,f in b?b[m]=b[f]:delete b[m];for(d=_;d>_-a+r;d--)delete b[d-1]}else if(r>a)for(d=_-a;d>C;d--)f=d+a-1,m=d+r-1,f in b?b[m]=b[f]:delete b[m];for(d=0;d<r;d++)b[d+C]=arguments[d+2];return b.length=_-a+r,u}})},a640:function(t,e,r){"use strict";var a=r("d039");t.exports=function(t,e){var r=[][t];return!!r&&a((function(){r.call(null,e||function(){throw 1},1)}))}},a9e3:function(t,e,r){"use strict";var a=r("83ab"),n=r("da84"),o=r("94ca"),i=r("6eeb"),s=r("5135"),c=r("c6b6"),l=r("7156"),u=r("c04e"),d=r("d039"),f=r("7c73"),m=r("241c").f,h=r("06cf").f,p=r("9bf2").f,g=r("58a8").trim,v="Number",b=n[v],_=b.prototype,C=c(f(_))==v,w=function(t){var e,r,a,n,o,i,s,c,l=u(t,!1);if("string"==typeof l&&l.length>2)if(l=g(l),e=l.charCodeAt(0),43===e||45===e){if(r=l.charCodeAt(2),88===r||120===r)return NaN}else if(48===e){switch(l.charCodeAt(1)){case 66:case 98:a=2,n=49;break;case 79:case 111:a=8,n=55;break;default:return+l}for(o=l.slice(2),i=o.length,s=0;s<i;s++)if(c=o.charCodeAt(s),c<48||c>n)return NaN;return parseInt(o,a)}return+l};if(o(v,!b(" 0o1")||!b("0b1")||b("+0x1"))){for(var y,I=function(t){var e=arguments.length<1?0:t,r=this;return r instanceof I&&(C?d((function(){_.valueOf.call(r)})):c(r)!=v)?l(new b(w(e)),r,I):w(e)},E=a?m(b):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),k=0;E.length>k;k++)s(b,y=E[k])&&!s(I,y)&&p(I,y,h(b,y));I.prototype=_,_.constructor=I,i(n,v,I)}},d3ca:function(t,e,r){"use strict";var a=r("9306"),n=r.n(a);n.a}}]);