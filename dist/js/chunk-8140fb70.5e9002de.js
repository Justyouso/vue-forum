(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8140fb70"],{"159b":function(t,e,a){var o=a("da84"),r=a("fdbc"),n=a("17c2"),i=a("9112");for(var s in r){var c=o[s],l=c&&c.prototype;if(l&&l.forEach!==n)try{i(l,"forEach",n)}catch(u){l.forEach=n}}},"17c2":function(t,e,a){"use strict";var o=a("b727").forEach,r=a("a640"),n=a("ae40"),i=r("forEach"),s=n("forEach");t.exports=i&&s?[].forEach:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}},"3cf7":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content-detail"},[a("div",{staticClass:"article-detail"},[a("div",{staticClass:"markdown-body author-detail"},[a("div",{staticClass:"author"},[t._v(t._s(t.article.author))]),a("el-button",{staticClass:"like",attrs:{"native-type":"button",size:"mini",type:t.follow?"":"danger",round:""},on:{click:function(e){return t.followed(t.follow)}}},[t._v(t._s(t.follow?"取消关注":"关注"))]),a("div",{staticClass:"article-info"},[t._v("字数"+t._s(t.article.body_num)+" 阅读 "+t._s(t.article.read))])],1),a("div",{staticClass:"editor"},[a("mavon-editor",{attrs:{boxShadow:!1},domProps:{innerHTML:t._s(t.article.body_html)}})],1),t.article.id?a("div",{staticClass:"markdown-body comment-warp"},[a("Comment",{attrs:{article:t.article.id}})],1):t._e()]),a("div",{staticClass:"relation_list"},[[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.articles}},[a("div",[a("el-table-column",{attrs:{label:"相关文章"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("router-link",{staticClass:"login-register",attrs:{tag:"a",to:"/article/detail/"+e.row.id,target:"_blank"}},[t._v(" "+t._s(e.row.title)+" ")]),a("p",[t._v("阅读 "+t._s(e.row.read))])]}}])})],1)])]],2),t.wordCloudData.length>0?a("div",{staticClass:"word_cloud pull-right"},[a("wordCloud",{attrs:{data:t.wordCloudData,"size-range":[10,30]}})],1):t._e()])},r=[],n=a("2423"),i=a("c24f"),s=a("05d5"),c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"comment"},[a("div",{staticClass:"comment-form"},[a("span",{staticClass:"pull-left"},[t._v("发表评论:")]),a("el-form",{ref:"commentForm",staticClass:"demo-ruleForm",attrs:{model:t.commentForm,"label-width":"100px"}},[a("el-form-item",{attrs:{prop:"comment",rules:[{required:!0,message:"评论不能为空"}]}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:6},placeholder:"请输入内容"},model:{value:t.commentForm.comment,callback:function(e){t.$set(t.commentForm,"comment",e)},expression:"commentForm.comment"}})],1),a("div",{staticClass:"btn pull-right"},[a("el-form-item",[a("el-button",{attrs:{size:"mini",type:"primary",round:""},on:{click:function(e){return t.submitForm("commentForm")}}},[t._v("发布")]),a("el-button",{attrs:{size:"mini",round:""},on:{click:function(e){return t.resetForm("commentForm")}}},[t._v("重置")])],1)],1)],1)],1),a("div",{staticClass:"comment-list"},[a("div",{staticClass:"comment-title"},[t._v(" 全部评论: "+t._s(t.totalpage)+" "),a("ul",{staticClass:"menu-tab pull-right"},t._l(t.menuTab,(function(e){return a("li",{key:e.id,class:[{current:e.current}],on:{click:function(a){return t.handleOrderChange(e)}}},[t._v(t._s(e.txt))])})),0)]),a("div",[[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.commentsData,"show-header":!1}},[a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"username"},[t._v(t._s(e.row.author))]),a("div",{staticClass:"time"},[t._v(t._s(e.row.timestamp))]),a("div",{staticClass:"comment"},[t._v(t._s(e.row.body))])]}}])})],1)]],2),a("div",{staticClass:"pull-right pageination"},[a("el-pagination",{attrs:{background:"","current-page":t.currentPage,"page-size":t.per_page,layout:"prev, pager, next",total:t.totalpage},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e},"update:total":function(e){t.totalpage=e}}})],1)])])},l=[],u=(a("99af"),a("4160"),a("159b"),a("b775"));function d(t){return u["a"].request({method:"get",url:"/comment/list",params:t})}function m(t){return u["a"].request({method:"post",url:"/comment/create",params:t})}var f={props:{article:{type:String}},data:function(){return{menuTab:[{txt:"按时间倒序",current:!0,type:"desc"},{txt:"按时间正序",current:!1,type:"asc"}],currentPage:1,totalpage:0,per_page:5,order:"desc",commentForm:{comment:""},commentsData:[]}},methods:{initData:function(){this.getUserInfo(),this.getComments(1)},getUserInfo:function(){this.userInfo=this.$store.state.userInfo,this.isLive=this.$store.state.isLive},getComments:function(t){var e=this,a={page:t,per_page:this.per_page,article:this.article,sort:this.order};d(a).then((function(t){e.commentsData=t.data.data,e.totalpage=t.data.total})).catch((function(t){console.log(t)}))},handleCurrentChange:function(t){this.getComments(t)},handleOrderChange:function(t){this.menuTab.forEach((function(t){t.current=!1})),this.currentPage=1,this.order=t.type,t.current=!0,this.getComments(1)},submitForm:function(t){var e=this;this.isLive?this.$refs[t].validate((function(a){if(!a)return console.log("error submit!!"),!1;var o={body:e.commentForm.comment,article:e.article,user:e.userInfo.uid};m(o).then((function(a){e.resetForm(t);var o=[{author:e.userInfo.username,author_id:e.userInfo.uid,body:e.commentForm.comment,article_id:e.article,timestamp:"刚刚"}];e.commentsData=o.concat(e.commentsData),e.totalpage=e.totalpage+1})).catch((function(t){console.log(t)}))})):this.$message({message:"请先登录",type:"warning"})},resetForm:function(t){this.$refs[t].resetFields()}},created:function(){this.initData()}},h=f,p=(a("6fee"),a("2877")),g=Object(p["a"])(h,c,l,!1,null,"04df6c60",null),v=g.exports,b={name:"articleDetail",components:{wordCloud:s["a"],Comment:v},data:function(){return{article:{},follow:!1,userinfo:{},islive:null,articles:[],wordCloudData:[]}},methods:{initData:function(){this.getArticleDetail(),this.getWordCloud(),this.getUserInfo()},getWordCloud:function(){var t=this,e={articles:this.articleId};Object(n["g"])(e).then((function(e){t.wordCloudData=e.data.data})).catch((function(t){console.log(t)}))},getArticleDetail:function(){var t=this;Object(n["b"])(this.articleId).then((function(e){t.article=e.data.data,t.getfollow(t.article.author_id),t.getArticles(t.article.author_id)})).catch((function(t){console.log(t)}))},getArticles:function(t){var e=this,a={page:1,per_page:5,author:t};Object(n["e"])(a).then((function(t){e.articles=t.data.data})).catch((function(t){console.log(t)}))},getUserInfo:function(){this.userinfo=this.$store.state.userInfo,this.islive=this.$store.state.isLive},getfollow:function(t){var e=this;if(this.islive){var a={user:this.userinfo.uid,author:t,type:2};Object(i["a"])(a).then((function(t){e.follow=t.data.data})).catch((function(t){console.log(t)}))}},followed:function(t){var e=this;if(this.checkUser()){var a={user:this.userinfo.uid,author:this.article.author_id};a.type=t?0:1,Object(i["a"])(a).then((function(a){e.follow=!t})).catch((function(t){console.log(t)}))}},checkUser:function(){if(this.islive)return!0;this.$router.push({name:"Login"})}},computed:{articleId:function(){return this.$route.params.articleId}},created:function(){this.initData()},mounted:function(){}},_=b,C=(a("67b0"),Object(p["a"])(_,o,r,!1,null,"37bf2345",null));e["default"]=C.exports},4160:function(t,e,a){"use strict";var o=a("23e7"),r=a("17c2");o({target:"Array",proto:!0,forced:[].forEach!=r},{forEach:r})},"67b0":function(t,e,a){"use strict";var o=a("f376"),r=a.n(o);r.a},"6fee":function(t,e,a){"use strict";var o=a("b075"),r=a.n(o);r.a},a640:function(t,e,a){"use strict";var o=a("d039");t.exports=function(t,e){var a=[][t];return!!a&&o((function(){a.call(null,e||function(){throw 1},1)}))}},b075:function(t,e,a){},f376:function(t,e,a){}}]);